<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>BLGY5121M Adv Stats - Mixed Models 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">BLGY5121M Adv Stats</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Advanced Statistics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./aiandgraphs.html">
 <span class="menu-text">Graphs and AI</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./lm.html">
 <span class="menu-text">Linear Models</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./power.html">
 <span class="menu-text">Power Analyses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./multivariatemethods.html">
 <span class="menu-text">Multivariate Methods</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./mixedmodels1.html" aria-current="page">
 <span class="menu-text">Mixed Models 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mixedmodels2.html">
 <span class="menu-text">Mixed Models 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./spatial.html">
 <span class="menu-text">Spatial Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./metaanalyses.html">
 <span class="menu-text">Meta-analyses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./finally.html">
 <span class="menu-text">Finally</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dragon-example" id="toc-dragon-example" class="nav-link active" data-scroll-target="#dragon-example">Dragon example</a>
  <ul class="collapse">
  <li><a href="#linear-models-reminder" id="toc-linear-models-reminder" class="nav-link" data-scroll-target="#linear-models-reminder">Linear models reminder</a></li>
  <li><a href="#why-use-a-mixed-model" id="toc-why-use-a-mixed-model" class="nav-link" data-scroll-target="#why-use-a-mixed-model">Why use a mixed model</a></li>
  <li><a href="#running-a-mixed-model" id="toc-running-a-mixed-model" class="nav-link" data-scroll-target="#running-a-mixed-model">Running a mixed model</a></li>
  <li><a href="#interpreting-mixed-model-output" id="toc-interpreting-mixed-model-output" class="nav-link" data-scroll-target="#interpreting-mixed-model-output">Interpreting mixed model output</a>
  <ul class="collapse">
  <li><a href="#estimate" id="toc-estimate" class="nav-link" data-scroll-target="#estimate">Estimate</a></li>
  <li><a href="#likelihood-ratio-test" id="toc-likelihood-ratio-test" class="nav-link" data-scroll-target="#likelihood-ratio-test">Likelihood ratio test</a></li>
  <li><a href="#aic-values" id="toc-aic-values" class="nav-link" data-scroll-target="#aic-values">AIC values</a></li>
  <li><a href="#random-slope-mixed-model" id="toc-random-slope-mixed-model" class="nav-link" data-scroll-target="#random-slope-mixed-model">Random slope mixed model</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#identifying-when-a-mixed-model-is-needed" id="toc-identifying-when-a-mixed-model-is-needed" class="nav-link" data-scroll-target="#identifying-when-a-mixed-model-is-needed">Identifying when a mixed model is needed</a>
  <ul class="collapse">
  <li><a href="#barley-yield-example" id="toc-barley-yield-example" class="nav-link" data-scroll-target="#barley-yield-example">Barley yield example</a></li>
  <li><a href="#caterpillar-example" id="toc-caterpillar-example" class="nav-link" data-scroll-target="#caterpillar-example">Caterpillar example</a></li>
  <li><a href="#petri-dish-example" id="toc-petri-dish-example" class="nav-link" data-scroll-target="#petri-dish-example">Petri dish example</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mixed Models 1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="dragon-example" class="level1">
<h1>Dragon example</h1>
<section id="linear-models-reminder" class="level2">
<h2 class="anchored" data-anchor-id="linear-models-reminder">Linear models reminder</h2>
<p>We will use a fictional study system - dragons! Click this <a href="https://raw.githubusercontent.com/acriach/BLGY5112M/main/data/dragons.csv">link to the dragon data</a> and save it in your data file in your R project.</p>
<p><img src="./img/dragons.png" class="img-fluid" alt="Three colourful cartoon dragons."></p>
<p>Imagine we went to eight mountain ranges (<code>mountainRange</code>) and collected data on the intelligence (<code>testScore</code>) and size (<code>bodyLength</code>) of 480 dragons. We want to know if size affects their intelligence since we want intelligent dragons that we can train but that aren’t too big and scary!</p>
<p>Load the csv dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dragons <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"data/dragons.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dragons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  testScore bodyLength mountainRange
1 16.147309   165.5485      Bavarian
2 33.886183   167.5593      Bavarian
3  6.038333   165.8830      Bavarian
4 18.838821   167.6855      Bavarian
5 33.862328   169.9597      Bavarian
6 47.043246   168.6887      Bavarian</code></pre>
</div>
</div>
<p><br></p>
<p>One way to analyse this data would be to fit a linear model.</p>
<p>Fit the model with <code>testScore</code> as the response and <code>bodyLength</code> as the predictor and have a look at the output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>basic.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(testScore <span class="sc">~</span> bodyLength, <span class="at">data =</span> dragons)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(basic.lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = testScore ~ bodyLength, data = dragons)

Residuals:
    Min      1Q  Median      3Q     Max 
-56.962 -16.411  -0.783  15.193  55.200 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -61.31783   12.06694  -5.081 5.38e-07 ***
bodyLength    0.55487    0.05975   9.287  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 21.2 on 478 degrees of freedom
Multiple R-squared:  0.1529,    Adjusted R-squared:  0.1511 
F-statistic: 86.25 on 1 and 478 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>View the ‘Code Explained’ if using lm is relatively new to you.</p>
<details>
<summary>
<strong>Code Explained</strong>
</summary>
<ul>
<li><code>basic.lm</code> is the name we gave to the model object. We could have chosen to name it anything.</li>
<li><code>lm()</code> is the function that runs the linear model</li>
<li><code>testScore</code> is the name of our variable that we want to be the response in the model.</li>
<li>The tidle <code>~</code> separates the response and predictors in the lm code.</li>
<li><code>bodyLength</code> is the name of the column of data that we want as the predictor in the model</li>
<li><code>data =</code> is an argument in the lm function</li>
<li><code>dragons</code> is the name of the dataset that we want R to use.</li>
</ul>
</details>
<p><br></p>
<p><strong>Challenge</strong></p>
<p>Write out how you could report the output from the summary. (You may want to look back at the Linear Models lesson.)</p>
<details>
<summary>
<strong>Answer</strong>
</summary>
Points you could take from the output include:<br>
* The coefficient estimate for <code>bodyLength</code> suggests that the model predicts <code>testScore</code> to increase by <code>0.55</code> for an increase of 1 in <code>bodyLength</code>.<br>
* The coefficient - standard error for <code>bodyLength</code> suggest the <code>testScore</code> can vary by 0.06.<br>
* The p value under <code>Pr(&gt;|t|)</code> is significant indicating we might reject the null hypothesis that there is no relationship between <code>bodyLength</code> and <code>testScore</code>.<br>
* R<sup>2</sup> is <code>0.1529</code> suggesting that 15.29% of the variance in <code>testScore</code> is explained by <code>bodyLength</code>.
</details>
<p><br></p>
<p>Let’s plot the data with ggplot2:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># load the package containing both ggplot2 and dplyr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dragonPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dragons, <span class="fu">aes</span>(<span class="at">x =</span> bodyLength, <span class="at">y =</span> testScore)) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Okay, both the linear model and the plot, suggest bigger dragons do better in our intelligence test. From our knowledge of dragons, that seems a bit odd: size shouldn’t really affect the test scores.</p>
<p>But are the assumptions met?</p>
<p><br></p>
<p>The plot above and below suggest we roughly meet the assumption of <strong>linearity</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(basic.lm, <span class="at">which =</span> <span class="dv">1</span>)  <span class="co"># This is not perfect so we'd need to keep this in mind. For your own data be careful:the bigger the sample size, the less of a trend you'd expect to see.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="mixedmodels1_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
<p>Next, check the assumption that the <strong>residuals are normal</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(basic.lm, <span class="at">which =</span> <span class="dv">2</span>)  <span class="co"># some deviations at the ends but this is generally fine</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="mixedmodels1_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
<p>Then check the assumption of <strong>homoscedasticity</strong> (equal variance of residuals):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(basic.lm, <span class="at">which =</span> <span class="dv">3</span>)  <span class="co"># a bit off but again doesn't look too bad</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="mixedmodels1_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
<p>But another assumption of a linear model is <strong>independent observations</strong>.</p>
<p>This brings us to…</p>
<p><br></p>
</section>
<section id="why-use-a-mixed-model" class="level2">
<h2 class="anchored" data-anchor-id="why-use-a-mixed-model">Why use a mixed model</h2>
<p>Consider the description of the dragon study again (repeated below).</p>
<blockquote class="blockquote">
<p>Imagine we went to eight mountain ranges (<code>mountainRange</code>) and collected data on the intelligence (<code>testScore</code>) and size (<code>bodyLength</code>) of 480 dragons.</p>
</blockquote>
<p><strong>Challenge</strong></p>
<p>What is it that may not be right about analysing the data using a lm. Type your thoughts in your R script.</p>
<details>
<summary>
<strong>Answer</strong>
</summary>
<p>The analysis has not considered that there could be differences in the dragons among the eight different <strong>mountain ranges</strong>.</p>
<p>The dragons can be grouped by mountain range. Therefore, the dragons (and data) are not <strong>independent</strong>.</p>
</details>
<p><br></p>
<button type="button" class="btn btn-success">
<p>Be aware that the word independent in statistics can be used to describe 1) independent data as well as 2) independent variables also known as predictors or factors. Confusingly, these are two different concepts.</p>
</button>
<p><br></p>
<p>It’s possible that the dragons from within each mountain range are more similar to each other than the dragons from different mountain ranges.</p>
<p>Have a look at a boxplot of the data to see if this is true:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(testScore <span class="sc">~</span> mountainRange, <span class="at">data =</span> dragons)  <span class="co"># Looks like something is going on here. The median test score for different mountain ranges is different.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="mixedmodels1_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We could also create a scatterplot and colour points by mountain range:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(colour_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dragons, <span class="fu">aes</span>(<span class="at">x =</span> bodyLength, <span class="at">y =</span> testScore, <span class="at">colour =</span> mountainRange)) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="mixedmodels1_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the above plots, it looks like our mountain ranges vary both in the dragon body length AND in their test scores. This confirms that our observations from within each of the ranges aren’t independent. We can’t ignore that: it could lead to a completely erroneous conclusion!</p>
<p>So what do we do?</p>
<p>We could run eight separate analyses and fit a regression for each of the mountain ranges.</p>
<p>Lets have a quick look at the data split by mountain range. We use the <code>facet_wrap()</code> to do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(split_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(bodyLength, testScore), <span class="at">data =</span> dragons) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> mountainRange) <span class="sc">+</span> <span class="co"># create a facet for each mountain range</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"length"</span>) <span class="sc">+</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"test score"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="mixedmodels1_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Doing eight analyses increases our chance of a <strong>Type 1 error</strong>. It also decreases the sample size from 480 dragons to 60. Not ideal!</p>
<p>We want to use all the data, but control for the data coming from different mountain ranges. We are not interested in quantifying test scores for each specific mountain range. This means we could use <code>mountainRange</code> as a <strong>random effect</strong> in a <strong>mixed model</strong>.</p>
<p>The explanatory variable <code>bodyLength</code> will be the <strong>fixed effect</strong> in the mixed model.</p>
<p><br></p>
<button type="button" class="btn btn-success">
<p>The word <strong>mixed</strong> in mixed model refers to the mix of <strong>random</strong> and <strong>fixed</strong> effects.</p>
<p>Do not be misled by the use of the word random for random effect. It does not mean that the variable is mathematically random in anyway.</p>
</button>
<p><br></p>
</section>
<section id="running-a-mixed-model" class="level2">
<h2 class="anchored" data-anchor-id="running-a-mixed-model">Running a mixed model</h2>
<p>Mixed models are run using the <code>lmer()</code> (linear mixed effect regression) function in the package <code>lme4</code>.</p>
<p>Library load the package ensuring it is installed first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A <strong>random effect</strong> is included in the model using the code <code>(1|mountainRange)</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mixed.lmer <span class="ot">&lt;-</span>  <span class="fu">lmer</span>(testScore <span class="sc">~</span> bodyLength <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>mountainRange), <span class="at">data =</span> dragons)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mixed.lmer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: testScore ~ bodyLength + (1 | mountainRange)
   Data: dragons

REML criterion at convergence: 3991.2

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.4815 -0.6513  0.0066  0.6685  2.9583 

Random effects:
 Groups        Name        Variance Std.Dev.
 mountainRange (Intercept) 339.7    18.43   
 Residual                  223.8    14.96   
Number of obs: 480, groups:  mountainRange, 8

Fixed effects:
            Estimate Std. Error t value
(Intercept) 43.70938   17.13489   2.551
bodyLength   0.03316    0.07865   0.422

Correlation of Fixed Effects:
           (Intr)
bodyLength -0.924</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="interpreting-mixed-model-output" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-mixed-model-output">Interpreting mixed model output</h2>
<p>There are no p values in the output. For mixed models, it is best to use other ways to determine if <code>bodyLength</code> has an effect on <code>testScore</code>.</p>
<section id="estimate" class="level3">
<h3 class="anchored" data-anchor-id="estimate">Estimate</h3>
<p>In the <code>Fixed effects</code> section of the output, look at the <code>Estimate</code> for <code>bodyLength</code>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>               Estimate  Std. Error   t value
(Intercept) 43.70938024 17.13488692 2.5508998
bodyLength   0.03316496  0.07864659 0.4216961</code></pre>
</div>
</div>
<p>Notice that the <code>Std. Error</code> suggests the estimate might be 0 for <code>bodyLength</code>. That means that the effect (think of effect as the slope of the fitted line in a scatterplot) might be no different to 0. In other words, there is no effect.</p>
<p><br></p>
</section>
<section id="likelihood-ratio-test" class="level3">
<h3 class="anchored" data-anchor-id="likelihood-ratio-test">Likelihood ratio test</h3>
<p>We could alternatively compare our model to a <strong>reduced model</strong> that does not contain our fixed effect <code>bodyLength</code>. We compare the two models in a <strong>likelihood ratio test</strong> using the function <code>anova()</code>.</p>
<button type="button" class="btn btn-success">
<p>Using <kbd><code>anova()</code></kbd> in this way to compare models can be done for other models, not just mixed models.</p>
</button>
<p><br></p>
<p>Fit a full model and a reduced model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>full.lmer <span class="ot">&lt;-</span> <span class="fu">lmer</span>(testScore <span class="sc">~</span> bodyLength <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>mountainRange), <span class="at">data =</span> dragons, <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>reduced.lmer <span class="ot">&lt;-</span> <span class="fu">lmer</span>(testScore <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>mountainRange), <span class="at">data =</span> dragons, <span class="at">REML =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
Notice the reduced model has <code>1</code> instead of <code>bodyLength</code>.
<details>
<summary>
<strong><code>REML=</code> Explained</strong>
</summary>
<p>In our previous model we skipped setting REML - we just left it as default (i.e.&nbsp;<code>REML=TRUE</code>). This means the model used the less biased <strong>restricted maximum likelihood</strong> method to come up with the estimates. You should report estimates from this model.</p>
<p>However, when you compare models you should use <code>REML=FALSE</code> so the model uses <strong>maximum likelihood</strong> which doesn’t rely on the coefficients of the fixed effects which are different (ie there is no fixed effect in the reduced model).</p>
</details>
<p><br></p>
<p>Now compare the full and reduced model using <code>anova()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced.lmer, full.lmer) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: dragons
Models:
reduced.lmer: testScore ~ 1 + (1 | mountainRange)
full.lmer: testScore ~ bodyLength + (1 | mountainRange)
             npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)
reduced.lmer    3 3999.7 4012.2 -1996.8   3993.7                     
full.lmer       4 4001.5 4018.2 -1996.7   3993.5 0.2075  1     0.6488</code></pre>
</div>
</div>
<p>The p value under <code>Pr(&gt;Chisq)</code> is not significant, there is no difference between the models. This means having <code>bodyLength</code> in the model explains none of the variance in the <code>testScore</code>. <code>bodyLength</code> has no effect.</p>
<p><br></p>
</section>
<section id="aic-values" class="level3">
<h3 class="anchored" data-anchor-id="aic-values">AIC values</h3>
<p>You can also assess models using AIC values. The model with the lower AIC value will fit the data better. Models with similar values are no different.</p>
<p>AIC values were given in the <code>anova()</code> output above or use the <code>AICc()</code> function in the <code>AICcmodavg</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AICcmodavg)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">AICc</span>(reduced.lmer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3999.736</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AICc</span>(full.lmer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4001.562</code></pre>
</div>
</div>
<p>Generally, if models are within 2 AICc units of each other they are very similar. Within 5 units they are quite similar, over 10 units difference and you can probably be happy with the model with lower AICc. As with p-values though, there is no “hard line” that’s always correct.</p>
<p><br></p>
<p><img src="./img/blue_dragon.png" class="img-fluid" alt="one blue cartoon dragon"></p>
<p>So we can conclude that body size has no effect on dragon intelligence and therefore we will be able to train the small ones and not use the big scary ones!</p>
<p>If we had not accounted for mountain range in a mixed model we may have came to the wrong conclusion.</p>
<p><br></p>
</section>
<section id="random-slope-mixed-model" class="level3">
<h3 class="anchored" data-anchor-id="random-slope-mixed-model">Random slope mixed model</h3>
<p>The mixed model we ran for the dragon data…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mixed.lmer <span class="ot">&lt;-</span>  <span class="fu">lmer</span>(testScore <span class="sc">~</span> bodyLength <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>mountainRange), <span class="at">data =</span> dragons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>…was a <strong>random intercept</strong> model.</p>
<p>Here’s the graph to accompany that.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="mixedmodels1_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice that the different coloured lines for each mountain range would have different <strong>intercepts</strong> but the same <strong>slope</strong> as each other. (The intercept is the point where a line crosses the y axis if it were that long.)</p>
<p><br></p>
<p>We could have run this mixed model instead…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mixed.ranslope <span class="ot">&lt;-</span> <span class="fu">lmer</span>(testScore <span class="sc">~</span> bodyLength <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> bodyLength<span class="sc">|</span>mountainRange), <span class="at">data =</span> dragons) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which is a <strong>random slope</strong> model.</p>
<p>Here’s the corresponding graph</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="mixedmodels1_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice the lines for each mountain range have different intercepts <strong>AND</strong> slopes.</p>
<p>Therefore, if your exploration of the data or understanding of the study system suggests that the relationship in each group of the random effect (i.e.&nbsp;in each mountainRange) is different, then use a random slope mixed model.</p>
<p><strong>Challenge</strong></p>
<p>Take some time to do an internet search for another definition of the difference between random intercept and random slope mixed models. Write this definition in your own words in your script.</p>
<p><br></p>
<p><br></p>
</section>
</section>
</section>
<section id="identifying-when-a-mixed-model-is-needed" class="level1">
<h1>Identifying when a mixed model is needed</h1>
<p>There are lots of available guides to help you run mixed models in R.</p>
<ul>
<li>This lesson is adapted from Hajduk’s <a href="https://ourcodingclub.github.io/tutorials/mixed-models/#six">Introduction to Linear Mixed Models</a> which gives more details than here.</li>
<li>There is also <a href="https://environmentalcomputing.net/statistics/mixed-models/">Environmental Computing</a> mixed model lessons.</li>
</ul>
<p><br></p>
<p>However, knowing when there is a random effect and therefore when a mixed model might be needed is more difficult.</p>
<p>Take your time to imagine each of the studies below, identifying the variables that is the <strong>random effect</strong> in each one and writing the <strong>code</strong> to run a mixed model. For example the code for the dragons was:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mixed.lmer <span class="ot">&lt;-</span>  <span class="fu">lmer</span>(testScore <span class="sc">~</span> bodyLength <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>mountainRange), <span class="at">data =</span> dragons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following check list and information might help you.</p>
<button type="button" class="btn btn-success">
<p>Random variable check list<br>
* Random effects are grouping factors. They are always categorical.<br>
* Usually you are not interested in a random effect’s impact on the response variable.<br>
* Usually you don’t care about the differences between the levels/groups of the random variable.<br>
* You suspect the random variable has an effect and therefore want to control for it.</p>
</button>
<p><br></p>
<button type="button" class="btn btn-success">
<p>A variable might be a random effect and fixed effect. Be clear on what hypothesis you are testing.</p>
</button>
<p><br></p>
<button type="button" class="btn btn-success">
<p>When a random variable has less than 5 groups it is advisable to not have it as a random variable in a mixed model. Instead, include it in a model as another predictor. You may want to look at the interaction.</p>
</button>
<p><br></p>
<p><br></p>
<section id="barley-yield-example" class="level2">
<h2 class="anchored" data-anchor-id="barley-yield-example">Barley yield example</h2>
<p><img src="./img/barley.jpg" class="img-fluid" alt="a close up of barley growing with a black background."></p>
<p>The effect of <code>variety</code> and type of nitrogen fertiliser <code>fertType</code> on the <code>yield</code> of barley plants, was tested in a field trial. The plants were grown in 20 different areas of the field called <code>area</code>, that were likely to vary in soil and water qualities that affected yield. The data was called <code>barley</code></p>
<div class="cell">

</div>
<p><br></p>
</section>
<section id="caterpillar-example" class="level2">
<h2 class="anchored" data-anchor-id="caterpillar-example">Caterpillar example</h2>
<p><img src="./img/cat.jpg" class="img-fluid" alt="a swallowtail caterpillar with green and black stripes with orange spots"></p>
<p>We want to know if development time can predict the weight of caterpillars. There may be genetic influences on weight too. We can only get 10 caterpillars from each female butterfly so use 14 females. For each of the 140 caterpillars, we note down which 1 to 14 <code>female</code> butterfly laid it, the development time <code>devTime</code> in hours and weight <code>wgt</code> in mg and call the dataset <code>butterflies</code>.</p>
<div class="cell">

</div>
<p><br></p>
</section>
<section id="petri-dish-example" class="level2">
<h2 class="anchored" data-anchor-id="petri-dish-example">Petri dish example</h2>
<p><img src="./img/petri.png" class="img-fluid" alt="a diagram of a cartoon petri dish with 10 yellow spots on it"></p>
<p>The effect of two bacterial inhibitors <code>inhib</code> on bacterial <code>growth</code> is tested by growing 10 spots of bacteria per 20 petri dishes <code>dish</code>. Bacterial growth seemed to vary among the petri dishes. Data was called <code>bacteria</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The random effect is `dish` as there are several bacterial growth per dish so they can be grouped according to what dish they are are in which might have an affect on growth.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(growth <span class="sc">~</span> inhib <span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>dish), <span class="at">data =</span> bacteria)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p><br></p>
<p>Adapted from the <a href="https://ourcodingclub.github.io/">Coding Club</a> tutorial <a href="https://ourcodingclub.github.io/tutorials/mixed-models/#six">Introduction to Linear Mixed Models</a> by Gabriela K Hajduk.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left"><a href="https://creativecommons.org/">CC Licensed</a></div>   
    <div class="nav-footer-right"><a href="https://github.com/acriach/BLGY5121MAdvStats">Source</a></div>
  </div>
</footer>



</body></html>